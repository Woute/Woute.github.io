var SVG="http://www.w3.org/2000/svg";var XLINK="http://www.w3.org/1999/xlink";(function(){var A=Object.prototype.toString,z="Null",p="Undefined",u="Boolean",f="Number",s="String",D="Object",w="[object Boolean]",g="[object Number]",k="[object String]",i="[object Array]";function j(F){switch(F){case null:return z;case (void 0):return p}var E=typeof F;switch(E){case"boolean":return u;case"number":return f;case"string":return s}return D}function C(E){try{if(d(E)){return"undefined"}if(E===null){return"null"}return E.inspect?E.inspect():String(E)}catch(F){if(F instanceof RangeError){return"..."}throw F}}function x(E,G){for(var F in G){E[F]=G[F]}return E}function r(E){if(j(E)!==D){throw new TypeError()}var F=[];for(var G in E){if(E.hasOwnProperty(G)){F.push(G)}}return F}function e(E){var F=[];for(var G in E){F.push(E[G])}return F}function y(E){return x({},E)}function t(E){return !!(E&&E.nodeType==1)}function n(E){return A.call(E)===i}var c=(typeof Array.isArray=="function")&&Array.isArray([])&&!Array.isArray({});if(c){n=Array.isArray}function b(E){return typeof E==="function"}function o(E){return A.call(E)===k}function q(E){return A.call(E)===g}function d(E){return typeof E==="undefined"}function h(F){for(var E in this){if(typeof this[E]!="function"){F(this[E],E)}}}function v(){return this.map()}function a(E){if(Object.isFunction(this.indexOf)){if(this.indexOf(E)!=-1){return true}}var F=false;this.each(function(G){if(G==E){F=true;throw {}}});return F}function l(G,F){var E=[];this.each(function(I,H){if(G.call(F,I,H)){E.push(I)}});return E}function B(G,F){G=G||function(H){return H};var E=[];this.each(function(I,H){E.push(G.call(F,I,H))});return E}x(Object,{inspect:C,extend:x,keys:Object.keys||r,values:e,clone:y,isElement:t,isArray:n,isFunction:b,isString:o,isNumber:q,isUndefined:d,toArray:v});Object.extend(Object.prototype,{each:h,map:B,select:l,include:a})})();function hashLength(b){var c=0;for(var a in b){if(typeof b[a]!="function"){c++}}return c}(function(){function a(b){return this.indexOf(b)>-1}Object.extend(String.prototype,{include:a})})();$break={};(function(){var e=Array.prototype.forEach;function g(l){for(var k=0,n=this.length;k<n;k++){l(this[k])}}if(!e){e=g}function b(l){var k=$A(arguments).slice(1);return this.map(function(n){return n[l].apply(n,k)})}function d(){this.length=0;return this}function c(){return this[0]}function h(){return this[this.length-1]}function i(){var k=Array.prototype.slice.call(arguments,0);return this.select(function(l){return !k.include(l)})}function f(k){return(k===false?this.toArray():this)._reverse()}function j(k){return this.inject([],function(o,n,l){if(0==l||(k?o.last()!=n:!o.include(n))){o.push(n)}return o})}function a(k){if(Object.isFunction(this.indexOf)){if(this.indexOf(k)!=-1){return true}}var l=false;this.each(function(n){if(n==k){l=true;throw $break}});return l}Object.extend(Array.prototype,{each:e,invoke:b,first:c,last:h,without:i,reverse:f,uniq:j,include:a})})();function $A(c){if(!c){return[]}if(!Object.isArray(c)){tmp=c;c=new Array();c.push(tmp)}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}Element.eventRegistry={UID:1};(function(){function c(f){if(!(f=$(f))){return}var e;if(f===window){e=0}else{if(typeof f._dotlanUID==="undefined"){f._dotlanUID=Element.eventRegistry.UID++}e=f._dotlanUID}if(!Element.eventRegistry[e]){return{}}else{return Element.eventRegistry[e]}}function d(g,e){if(!(g=$(g))){return}var f;if(g===window){f=0}else{if(typeof g._dotlanUID==="undefined"){g._dotlanUID=Element.eventRegistry.UID++}f=g._dotlanUID}if(typeof(e)=="object"){Element.eventRegistry[f]=e}else{if(Element.eventRegistry[f]){delete (Element.eventRegistry[f])}}}function b(g,f,h){if(!(g=$(g))){return}var e=Element.getEventRegistry(g);if(!e[f]){e[f]=[h]}else{e[f].push(h)}Element.setEventRegistry(g,e)}function a(g,f,h){if(!(g=$(g))){return}if(f){var e=Element.getEventRegistry(g);if(h&&Object.isArray(e[f])){e[f]=e[f].without(h)}if(!h||!e[f].length){delete (e[f])}if(!e.map().length){Element.setEventRegistry(g)}else{Element.setEventRegistry(g,e)}}else{Element.setEventRegistry(g)}}Object.extend(Element,{getEventRegistry:c,setEventRegistry:d,addEventRegistry:b,removeEventRegistry:a});Element.extend=function(e){if(!e){return e}if(typeof(e.on)==="function"){return e}return Object.extend(e,{on:function(f,g){return dotSvg.observe(this,f,g)},unbind:function(f,g){return dotSvg.stopObserving(this,f,g)},attr:function(g,f){return dotSvg.attr(this,g,f)},attrs:function(g,f){return dotSvg.attr(this,g,f)},setAttr:function(g,f){return dotSvg.setAttr(this,g,f)},insert:function(f){if(!f){return this}this.appendChild(f);return this},remove:function(){return dotSvg.remove(this)},svgText:function(f){var g=dotSvg.createTextNode(f);this.appendChild(g);return this},clear:function(){return dotSvg.clear(this)}})}})();function $(b){if(!b){return b}if(arguments.length>1){for(var a=0,d=[],c=arguments.length;a<c;a++){d.push($(arguments[a]))}return d}if(typeof(b)=="string"){b=document.getElementById(b)}return Element.extend(b)}function $$(l){if(!l){return[]}var h=[];var o=[];var d=$A(l.split(/\s+/));for(var e=0;e<d.length;e++){var k=d[e],n=[],f=((e+1)==d.length);if(m=k.match(/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/)){if(f){o.push($(document.getElementById(m[1])))}else{n.push($(document.getElementById(m[1])))}}else{if(m=k.match(/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/)){var b=$A((h.length?h:document));var g=$A(dotSvg.byClassName(m[1],b));for(var j=0;j<g.length;j++){if(f){o.push($(g[j]))}else{n.push($(g[j]))}}}else{if(m=k.match(/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/)){var b=$A(h.length?h:document);b.each(function(p){var q=p.getElementsByTagName(m[1]);for(var i=0;i<q.length;i++){if(f){o.push($(q[i]))}else{n.push($(q[i]))}}})}}}h=n}return o}var dotSvg={doc:0,init:function(a){this.doc=a.target.ownerDocument},byClassName:function(h,j){var d=$A(j||document);var a=dotSvg.helper.getNodes(d);var e=" "+h+" ";for(var f=0,g=[],c,b;c=a[f];f++){b=c.className||"";b=b.baseVal||b;if(b.length==0){continue}if(b==h||(" "+b+" ").include(e)){g.push(c)}}return g},helper:{getNodes:function(a){for(var c=0,b=[],d;d=a[c];c++){dotSvg.helper.concat(b,d.getElementsByTagName("*"))}return b},concat:function(d,c){for(var e=0,f;f=c[e];e++){d.push(f)}return d}},create:function(a,b){var c=$(document.createElementNS(SVG,a));c.attr(b);return c},createTextNode:function(a,b){var c=$(document.createTextNode(a));c.attr(b);return c},attr:function(c,b,a){if(!c){return c}if(typeof(b)!="object"&&typeof(a)=="undefined"){return dotSvg.getAttr(c,b)}else{if(typeof(b)!="object"){return dotSvg.setAttr(c,b,a)}else{b.each(function(e,d){c=dotSvg.setAttr(c,d,e)});return c}}},setAttr:function(c,b,a){if(!c||Object.isUndefined(b)||Object.isFunction(b)){return c}if(b.match(/^xlink:/)){c.setAttributeNS(XLINK,b,a)}else{c.setAttribute(b,a)}return c},getAttr:function(b,a){if(!b.getAttribute){return}return b.getAttribute(a)},remove:function(a){if(!a){return a}var b=$A(Element.getEventRegistry(a));dotSvg.stopObserving(a);if(a.parentNode){a.parentNode.removeChild(a)}},clear:function(c){if(!(c=$(c))){return}var a=dotSvg.helper.getNodes($A(c));for(var b=0;b<a.length;b++){node=a[b];if(node){$(node).remove()}}return this},observe:function(b,a,c){if(!b){return b}b=$(b);if(b.addEventListener){b.addEventListener(a,c,false)}else{b.attachEvent("on"+a,c)}Element.addEventRegistry(b,a,c);return b},stopObserving:function(c,a,d){if(!c){return c}var e=Element.getEventRegistry(c);if(!a){for(var a in e){if(typeof(a)!="function"){dotSvg.stopObserving(c,a)}}return}if(!d){reg=$A(e[a]);for(var b=0;b<reg.length;b++){if(reg[b]){dotSvg.stopObserving(c,a,reg[b])}}return}if(c&&c.removeEventListener){c.removeEventListener(a,d,false)}else{if(c&&c.detachEvent){c.detachEvent("on"+a,d)}}Element.removeEventRegistry(c,a,d);return c}};var SVGWorld={doc:0,x:0,y:0,oldX:0,oldY:0,docH:0,docW:0,viewH:0,viewW:0,drag:false,limitX:0,limitXR:0,limitXL:0,vb_x:0,vb_y:0,vb_w:0,vb_h:0,margin:[13,13,13,13],limitY:0,realLimitX:0,realLimitY:0,oldZoom:100,zoom:100,zoomDiff:25,zMin:100,zMax:10000,zMaxFocus:3000,wheel:false,sysGrid:40,conGrid:20,sysOnMap:0,waitSysUpdate:false,moveSysNew:0,moveSysUpdate:0,moveSysRemove:0,transform:"",scale:"",lj:1,ls:1,f:9,focusOn:false,route:{},route_wp:[],route_alt:[],route_on:[],route_alt_cur:false,smin_y:-1,smax_y:-1,smin_x:-1,smax_x:-1,rxp:/[^'a-z0-9-\.,:]/gi,init:function(c,b,a){this.doc=c.target.ownerDocument;dotSvg.init(c);$("svgdoc").attr({width:b,height:a,viewBox:"0 0 "+b+" "+a});this.docW=b;this.docH=a;this.viewW=b;this.viewH=a;if(navigator.userAgent.indexOf("AppleWebKit/")>-1){this.zMax=6500}$(window).on("contextmenu",function(d){SVGWorld.nullEvent(d)});this.enableControls();$("connections").insert(dotSvg.create("path",{"class":"j",id:"j",d:WDB.path.j}));$("connections").insert(dotSvg.create("path",{"class":"jc",id:"jc",d:WDB.path.jc}));$("connections").insert(dotSvg.create("path",{"class":"jr",id:"jr",d:WDB.path.jr}));$("sysdots").insert(dotSvg.create("path",{"class":"sd",id:"sd",d:WDB.path.sd}));this.update()},setLimit:function(){this.limitXR=((this.docW*(this.zoom/100))-this.viewW<0)?((this.docW*(this.zoom/100))-this.viewW)/2:(this.docW*(this.zoom/100))-this.viewW;this.limitXL=(this.limitXR<0)?this.limitXR:0;this.limitY=((this.docH*(this.zoom/100))-this.viewH<0)?0:(this.docH*(this.zoom/100))-this.viewH},update:function(){if(isNaN(this.x)){this.x=0}else{if(this.x<this.limitXL){this.x=this.limitXL}else{if(this.x>this.limitXR){this.x=this.limitXR}}}if(isNaN(this.y)){this.y=0}else{if(this.y<0){this.y=0}else{if(this.y>this.limitY){this.y=this.limitY}}}this.zoom=isNaN(this.zoom)?this.zMin:(this.zoom<=this.zMin)?this.zMin:(this.zoom>=this.zMax)?this.zMax:this.zoom;this.vb_x=(Math.round((this.x/(this.zoom/100))*100)/100);this.vb_y=(Math.round((this.y/(this.zoom/100))*100)/100);this.vb_w=(Math.round((this.docW/(this.zoom/100))*100)/100);this.vb_h=(Math.round((this.docH/(this.zoom/100))*100)/100);this.transform="translate("+(this.vb_x*(this.zoom/100)*-1)+","+(this.vb_y*(this.zoom/100)*-1)+")";this.scale="scale("+(this.zoom/100)+")";$("map").attr("transform",this.transform+" "+this.scale);$("mapover").attr("transform",this.transform+" "+this.scale);$("regionnames").attr("transform",this.transform);if(this.oldZoom!=this.zoom){$("controls").attr("title","Current Zoom: "+this.zoom);this.lj=(Math.round((1/(this.zoom/100))*1000)/1000)+"";this.ls=this.lj*((this.zoom>300)?3:(this.zoom>200)?2.5:(this.zoom>100)?2:1.5);$("sd").attr("style","stroke-width: "+SVGWorld.ls);$("j").attr("style","stroke-width: "+SVGWorld.lj);$("jc").attr("style","stroke-width: "+SVGWorld.lj);$("jr").attr("style","stroke-width: "+SVGWorld.lj);$$(".jx").each(function(b){$(b).attr("style","stroke-width: "+(SVGWorld.lj*7))});$$(".jb").each(function(b){$(b).attr("style","stroke-width: "+(SVGWorld.lj*2))});this.oldZoom=this.zoom}if(!this.waitSysUpdate){this.moveSysNew=0;this.moveSysUpdate=0;this.moveSysRemove=0;this.route_alt=$A(this.route_alt);this.route_on=$A(this.route_on);this.route_wp=$A(this.route_wp);this.update_regiontext();this.update_constellation();this.update_sys();this.update_systext();if(this.zoom<400&&this.route_alt.length){for(var a=0;a<this.route_alt.length;a++){this.drawSystem(parseInt(this.route_alt[a]))}}if(this.zoom>=400&&this.zoom<1100&&this.route_on.length){for(var a=0;a<this.route_on.length;a++){this.drawSystemName(parseInt(this.route_on[a]))}}if(this.route_wp.length>0){for(var a=0;a<this.route_wp.length;a++){this.drawSystem(parseInt(this.route_wp[a]));this.drawSystemName(parseInt(this.route_wp[a]))}}}},enableControls:function(){dotSvg.observe(window,"mousedown",function(a){SVGWorld.moveStart(a)});dotSvg.observe(window,"mousemove",function(a){SVGWorld.moveDo(a)});dotSvg.observe(window,"mouseup",function(a){SVGWorld.moveStop(a)});dotSvg.observe(window,"keydown",function(a){SVGWorld.keyboard(a)});document.onselectstart=SVGWorld.nullEvent;document.ondragstart=SVGWorld.nullEvent;dotSvg.observe("zoom_in","click",function(){SVGWorld.zoomIn()});dotSvg.observe("zoom_out","click",function(){SVGWorld.zoomOut()});dotSvg.observe("wheel_on","click",function(){SVGWorld.enableWheel(true)});dotSvg.observe("wheel_off","click",function(){SVGWorld.disableWheel(true)});$("controls").attr("style","")},enableWheel:function(a){if(!this.wheel){dotSvg.observe(document,"mousewheel",function(b){SVGWorld.mousewheel(b)});dotSvg.observe(document,"DOMMouseScroll",function(b){SVGWorld.mousewheel(b)})}$("wheel_on").attr("style","cursor: pointer; display:none;");$("wheel_off").attr("style","cursor: pointer; ");this.wheel=true},disableWheel:function(a){if(this.wheel){dotSvg.stopObserving(document,"mousewheel");dotSvg.stopObserving(document,"DOMMouseScroll")}$("wheel_on").attr("style","cursor: pointer; ");$("wheel_off").attr("style","cursor: pointer; display:none");this.wheel=false},keyboard:function(a){a=a||window.event;if(a.keyCode==40){this.y+=20;this.update()}else{if(a.keyCode==38){this.y-=20;this.update()}else{if(a.keyCode==39){this.x+=20;this.update()}else{if(a.keyCode==37){this.x-=20;this.update()}else{if(a.keyCode==187||a.keyCode==107){this.zoomIn()}else{if(a.keyCode==189||a.keyCode==109){this.zoomOut()}}}}}}},mousewheel:function(a){var b=0;a=a||window.event;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version&&window.opera.version()<10){b=-b}}else{if(a.detail){b=-a.detail/3}}if(b>0){this.zoomIn(a,b)}if(b<0){this.zoomOut(a,b)}if(a.preventDefault){a.preventDefault()}a.returnValue=false},moveStart:function(a){if(a.button>0){return}this.drag=true;this.oldX=a.pageX;this.oldY=a.pageY},moveDo:function(a){if(!this.drag){return false}this.x=this.x-parseInt(a.pageX-this.oldX);this.y=this.y-parseInt(a.pageY-this.oldY);this.oldX=a.pageX;this.oldY=a.pageY;if(!this.waitSysUpdate){this.waitSysUpdate=true;$("systems").attr("style","display: none");$("sysover").attr("style","display: none");$("systemnames").attr("style","display: none");$("systextover").attr("style","display: none");$("constellations").attr("style","display: none")}this.update()},moveStop:function(a){if(!this.drag){return}this.drag=false;this.waitSysUpdate=false;this.update()},setZoom:function(b,a,c){b=isNaN(b)?this.zMin:(b<=this.zMin)?this.zMin:(b>=this.zMax)?this.zMax:b;if(this.zoom==b&&typeof(a)=="undefined"&&typeof(c)=="undefined"){return}this.zoom=b;this.setLimit();if(typeof(a)!="undefined"&&typeof(c)!="undefined"){this.setPos(a,c)}this.hide_sys();this.hide_systext();this.hide_constellation();this.hide_regiontext();this.update()},setPos:function(a,b){if(typeof(a)!="undefined"&&typeof(b)!="undefined"){this.x=Math.round(a*100)/100;this.y=Math.round(b*100)/100}this.update()},zoomIn:function(b,e){this.zoomDiff=(Math.floor(this.zoom/100)*100)/2;var a=Math.floor((this.zoom+this.zoomDiff)/this.zoomDiff)*this.zoomDiff;var d=(b&&b.pageX)?b.pageX:this.viewW/2;var c=(b&&b.pageY)?b.pageY:this.viewH/2;a=(a<=this.zMin)?this.zMin:(a>=this.zMax)?this.zMax:a;this.x=Math.round(((this.x+d)/(this.zoom/100))*(a/100))-d;this.y=Math.round(((this.y+c)/(this.zoom/100))*(a/100))-c;this.setZoom(a)},zoomOut:function(b,e){this.zoomDiff=(Math.floor((this.zoom-this.zoomDiff)/100)*100)/2;var a=Math.floor((this.zoom-this.zoomDiff)/this.zoomDiff)*this.zoomDiff;var d=(b&&b.pageX)?b.pageX:this.viewW/2;var c=(b&&b.pageY)?b.pageY:this.viewH/2;a=(a<=this.zMin)?this.zMin:(a>=this.zMax)?this.zMax:a;this.x=Math.round(((this.x+d)/(this.zoom/100))*(a/100))-d;this.y=Math.round(((this.y+c)/(this.zoom/100))*(a/100))-c;this.setZoom(a)},update_sys:function(){this.hide_sys();if(this.zoom>=400){for(id in WDB.system){var a=WDB.system[id];if(a.x>=this.vb_x&&a.x<=(this.vb_x+this.vb_w)&&a.y>=this.vb_y&&a.y<=(this.vb_y+this.vb_h)){this.drawSystem(id)}else{this.removeSystem(id)}}}else{$("systems").clear();$("sysover").clear()}$("systems").attr("style","");$("sysover").attr("style","")},hide_sys:function(){this.sysOnMap=0;$("systems").attr("style","display: none");$("sysover").attr("style","display: none")},update_systext:function(){this.hide_systext();if(this.zoom>=1100){for(id in WDB.system){if(typeof(WDB.system[id])!="function"){var a=WDB.system[id];if(a.x>=this.vb_x&&a.x<=(this.vb_x+this.vb_w)&&a.y>=this.vb_y&&a.y<=(this.vb_y+this.vb_h)){this.drawSystemName(id)}else{this.removeSystemName(id)}}}}else{$("systemnames").clear();$("systextover").clear()}$("systemnames").attr("style","");$("systextover").attr("style","")},hide_systext:function(){$("systemnames").attr("style","display: none");$("systextover").attr("style","display: none")},update_constellation:function(){this.hide_constellation();if(this.zoom>=600&&this.zoom<1100){for(id in WDB.constellation){if(typeof(WDB.constellation[id])!="function"){var a=WDB.constellation[id];if(a.x>=this.vb_x&&a.x<=(this.vb_x+this.vb_w)&&a.y>=this.vb_y&&a.y<=(this.vb_y+this.vb_h)){this.drawConstellationName(id)}else{this.removeConstallationName(id)}}}}else{$("constellations").clear()}$("constellations").attr("style","")},hide_constellation:function(){$("constellations").attr("style","display: none")},update_regiontext:function(){var a=dotSvg.helper.getNodes($("regionnames"));if(!a.length){this.hide_regiontext();for(id in WDB.region){if(typeof(WDB.region[id])!="function"){this.drawRegionName(id)}}}$("regionnames").attr("style","")},hide_regiontext:function(){$("regionnames").attr("style","display: none")},getSystemUrl:function(c){var b=WDB.system[c];if(!b){return""}var a=WDB.region[b.r];return"/map/"+a.n.replace(this.rxp,"_")+"/"+b.n.replace(this.rxp,"_")},getConstellationUrl:function(c){var a=WDB.constellation[c];if(!a){return""}var b=WDB.region[a.r];return"/map/"+b.n.replace(this.rxp,"_")+"/"+a.n.replace(this.rxp,"_")},getRegionUrl:function(b){var a=WDB.region[b];if(!a){return""}return"/map/"+a.n.replace(this.rxp,"_")},system_over:function(a){this.drawSystemName(a,true)},system_out:function(d){var c=this.route_wp.include(parseInt(d)+30000000)||this.route_wp.include(d);var a=this.route_alt.include(parseInt(d)+30000000)||this.route_alt.include(d);var b=this.route_on.include(parseInt(d)+30000000)||this.route_on.include(d);if(!c&&!b&&this.zoom<1100){if($("t"+d)){$("t"+d).remove()}}if(!c){if($("th"+d)){$("th"+d).remove()}}},click:function(h,f){var d=WDB.system[h];var b=WDB.region[d.r];var a=this.route_alt.include(parseInt(h)+30000000)||this.route_alt.include(h);var c="";if(parent){if(a&&this.route_alt_cur&&WDB.system[(parseInt(this.route_alt_cur)-30000000)]){var g=WDB.system[(parseInt(this.route_alt_cur)-30000000)];parent.routeJump.altSelect(g.n,d.n)}else{parent.location.href=this.getSystemUrl(h)}}},setFocus:function(b){this.resetFocus();if(b){b=$A(b);for(var a=0;a<b.length;a++){var d=b[a];var c=WDB.system[(parseInt(d)-30000000)]||WDB.system[parseInt(d)];if(c){this.smin_x=(c.x<this.smin_x||this.smin_x<0)?c.x:this.smin_x;this.smax_x=(c.x>this.smax_x||this.smax_x<0)?c.x:this.smax_x;this.smin_y=(c.y<this.smin_y||this.smin_y<0)?c.y:this.smin_y;this.smax_y=(c.y>this.smax_y||this.smax_y<0)?c.y:this.smax_y}}}this.moveFocus()},resetFocus:function(){this.smin_y=-1;this.smax_y=-1;this.smin_x=-1;this.smax_x=-1},moveFocus:function(){if(this.smin_y>-1&&this.smax_y>-1&&this.smin_x>-1&&this.smax_x>-1){var h=this.smin_y;var n=this.smax_y;var j=this.smin_x;var a=this.smax_x;var d=(a-j)+this.margin[3]+this.margin[1];var k=(n-h)+this.margin[0]+this.margin[2];var b=this.docW/this.docH;var c=d/k;if(c<b){var e=d;d=Math.round(k*b);j-=Math.round((d-e)/2)}else{var f=k;k=Math.round(d/b);h-=Math.round((k-f)/2)}var l=Math.round(((this.docW/d>this.docH/k)?this.docW/d:this.docH/k)*100);var i=j-this.margin[3];var g=h-this.margin[0];this.setZoom(l,i*(l/100),g*(l/100));this.focusOn=false}},nullEvent:function(a){if(a.preventDefault){a.preventDefault()}if(a.stopPropagation){a.stopPropagation()}return false},closeContextMenu:function(a){window.parent.MapUniverseUtil.contextMenu("close");$(window).unbind("click",SVGWorld.closeContextMenu)},openContextMenu:function(d,b,c,a){if(b==3&&c<10000000){c+=10000000}else{if(b==4&&c<20000000){c+=20000000}else{if(b==5&&c<30000000){c+=30000000}}}if(!window.parent||!window.parent.MapUniverseUtil){return}window.parent.MapUniverseUtil.contextMenu(a,b,c,d.pageX,d.pageY);$(window).on("click",SVGWorld.closeContextMenu);return SVGWorld.nullEvent(d)},drawSystem:function(b){var b=(b>=30000000)?(parseInt(b)-30000000):parseInt(b);var i=WDB.system[b];var h=Math.round((i.x-this.vb_x)*(this.zoom/100));var g=Math.round((i.y-this.vb_y)*(this.zoom/100));if(h<-30||h>this.docW+30||g<-30||g>this.docH+30){this.removeSystem(b);this.moveSysRemove++;return}var d=this.route_wp.include(parseInt(b)+30000000)||this.route_wp.include(b);var j=this.route_alt.include(parseInt(b)+30000000)||this.route_alt.include(b);var e=this.route_on.include(parseInt(b)+30000000)||this.route_on.include(b);var f=i.c+((d)?"w":(e)?"r":(j)?"a":"");var a=(d)?"sysover":"systems";if($("s"+b)&&$("s"+b).attr("xlink:href")=="#"+f){$("s"+b).attr({x:h-6,y:g-6});this.moveSysUpdate++;this.sysOnMap++;return}else{this.removeSystem(b)}this.moveSysNew++;$(a).insert($(dotSvg.create("use",{"xlink:href":"#"+f,id:"s"+b,x:h-6,y:g-6,title:i.n})).on("mouseup",function(c){if(c.button==0){SVGWorld.click(b)}}).on("mouseover",function(){SVGWorld.system_over(b)}).on("mouseout",function(){SVGWorld.system_out(b)}).on("contextmenu",function(c){SVGWorld.openContextMenu(c,5,b,SVGWorld.getSystemUrl(b))}));this.sysOnMap++},removeSystem:function(a){if($("s"+a)){$("s"+a).remove()}},drawSystemName:function(b,e){var b=(b>=30000000)?(parseInt(b)-30000000):parseInt(b);var e=e||false;var l=WDB.system[b];var k=Math.round((l.x-this.vb_x)*(this.zoom/100));var j=Math.round((l.y-this.vb_y)*(this.zoom/100));if(k<-50||k>this.docW+50||j<-50||j>this.docH+50){this.removeSystemName(b);return}var d=this.route_wp.include(parseInt(b)+30000000)||this.route_wp.include(b);var n=this.route_alt.include(parseInt(b)+30000000)||this.route_alt.include(b);var h=this.route_on.include(parseInt(b)+30000000)||this.route_on.include(b);var g=10;var i="t"+((d)?"w":(h)?"r":"");var a=(d)?"systextover":"systemnames";var e=d||e||false;if(($("th"+b)&&e||!$("th"+b)&&!e)&&$("t"+b)&&$("t"+b).attr("class")==i){if(d||e){$("th"+b).attr({x:k+g,y:j})}$("t"+b).attr({x:k+g,y:j});return}else{this.removeSystemName(b)}if(e){$(a).insert($(dotSvg.create("text",{id:"th"+b,x:k+g,y:j,"class":i+"h"})).svgText(l.n))}$(a).insert($(dotSvg.create("text",{id:"t"+b,x:k+g,y:j,"class":i})).svgText(l.n).on("mouseup",function(c){if(c.button==0){SVGWorld.click(b)}}).on("contextmenu",function(c){SVGWorld.openContextMenu(c,5,b,SVGWorld.getSystemUrl(b))}))},removeSystemName:function(a){if($("th"+a)){$("th"+a).remove()}if($("t"+a)){$("t"+a).remove()}},drawConstellationName:function(j){var j=(j>=20000000)?(parseInt(j)-20000000):parseInt(j);var d=true;var b=WDB.constellation[j];var a=Math.round((b.x-this.vb_x)*(this.zoom/100));var i=Math.round((b.y-this.vb_y)*(this.zoom/100));if(a<-50||a>this.docW+50||i<-50||i>this.docH+50){this.removeConstallationName(j);return}var e=10;var h="c";var g="constellations";if($("ch"+j)&&$("c"+j)&&$("c"+j).attr("class")==h){$("ch"+j).attr({x:a+e,y:i});$("c"+j).attr({x:a+e,y:i});return}else{this.removeConstallationName(j)}if(d){$(g).insert($(dotSvg.create("text",{id:"ch"+j,x:a+e,y:i,"class":h+"h"})).svgText(b.n))}$(g).insert($(dotSvg.create("text",{id:"c"+j,x:a+e,y:i,"class":h})).svgText(b.n).on("mouseup",function(c){if(c.button==0){parent.location.href=SVGWorld.getConstellationUrl(j)}}).on("contextmenu",function(c){SVGWorld.openContextMenu(c,4,j,SVGWorld.getConstellationUrl(j))}))},removeConstallationName:function(a){if($("ch"+a)){$("ch"+a).remove()}if($("c"+a)){$("c"+a).remove()}},drawRegionName:function(h){var d=WDB.region[h];var g="r"+((this.zoom>200)?"r":"");var b=true;var a=Math.round((d.x*(this.zoom/100)));var f=Math.round((d.y*(this.zoom/100)));var e="regionnames";if($("rh"+h)&&$("r"+h)&&$("r"+h).attr("class")==g){$("rh"+h).attr({x:a,y:f});$("r"+h).attr({x:a,y:f});return}else{this.removeRegionName(h)}if(b){$(e).insert($(dotSvg.create("text",{id:"rh"+h,x:a,y:f,"class":g+"h"})).svgText(d.n))}$(e).insert($(dotSvg.create("text",{id:"r"+h,x:a,y:f,"class":g})).svgText(d.n).on("mouseup",function(c){if(c.button==0){parent.location.href=SVGWorld.getRegionUrl(h)}}).on("contextmenu",function(c){SVGWorld.openContextMenu(c,3,h,SVGWorld.getRegionUrl(h))}))},removeRegionName:function(a){if($("rh"+a)){$("rh"+a).remove()}if($("r"+a)){$("r"+a).remove()}},drawRoute:function(a){this.hideRoute();if(a){this.route=a}if($A(this.route.j)&&$A(this.route.j).length){$A(this.route.j).each(function(c){var b=c.split("-");var e=WDB.system[(parseInt(b[0])-30000000)];var d=WDB.system[(parseInt(b[1])-30000000)];if(e&&d){$("routes").insert(dotSvg.create("line",{x1:Math.round(e.x*100)/100,y1:Math.round(e.y*100)/100,x2:Math.round(d.x*100)/100,y2:Math.round(d.y*100)/100,"class":"jx",style:"stroke-width: "+(SVGWorld.lj*7)+"px"}))}})}if($A(this.route.jb)&&$A(this.route.jb).length){$A(this.route.jb).each(function(f){var s=f.split("-");var p=WDB.system[(parseInt(s[0])-30000000)];var q=WDB.system[(parseInt(s[1])-30000000)];if(p&&q){var b=Math.round(p.x*100)/100;var r=Math.round(p.y*100)/100;var l=Math.round(q.x*100)/100;var i=Math.round(q.y*100)/100;var g=Math.sqrt((b-l)*(b-l)+(r-i)*(r-i));var k=g/5;var e=k/g;var d=(i-r)*e;var c=(l-b)*e;var o=(b+(l-b)/2)+d;var n=(r+(i-r)/2)-c;$("jumps").insert(dotSvg.create("path",{d:"M"+b+","+r+" S"+o+","+n+" "+l+","+i,"class":"jb "+s[2],style:"stroke-width: "+(SVGWorld.lj*3)+"px"}))}})}this.route_on=$A(this.route.sys);this.route_wp=$A(this.route.wp);this.route_alt=$A(this.route.alt);if(this.focusOn=="route"&&this.route.sys.length>0){this.setFocus(this.route.sys)}else{this.setFocus([].concat(this.route.wp).concat(this.route.alt))}this.update()},hideRoute:function(){this.route_alt=[];this.route_on=[];this.route_wp=[];$("routes").clear();$("jumps").clear()},drawJumpMidpoints:function(a){this.hideJumpMidpoints();this.route_alt=$A(a.sys);this.route_alt_cur=a.current;if(this.focusOn=="jumpmid"){var b=a.sys;b.push(a.next);b.push(a.prev);b.push(a.current);this.setFocus(b)}this.update()},hideJumpMidpoints:function(){this.route_alt=[]},drawJumpRange:function(a){this.hideJumpRange();this.route_alt=$A(a.sys);this.route_wp=$A(a.wp);if(this.focusOn=="jumprange"){this.setFocus(a.sys)}this.update()},hideJumpRange:function(){this.hideRoute()},drawHighlight:function(b,a){this.focusOn=a?"search":false;SVGWorld.route_alt=$A(b);SVGWorld.setFocus($A(b))}};var SVGMap={doc:false,x:0,y:0,oldX:0,oldY:0,docH:0,docW:0,viewH:0,viewW:0,drag:false,limitX:0,limitXR:0,limitXL:0,vb_x:0,vb_y:0,vb_w:0,vb_h:0,transform:"",scale:"",adminMode:false,limitY:0,realLimitX:0,realLimitY:0,oldZoom:100,zoom:100,zMin:100,zMax:400,wheel:false,MapUtil:false,init:function(f){this.doc=f.target.ownerDocument;this.docW=parseInt($("svgdoc").attr("width"));this.docH=parseInt($("svgdoc").attr("height"));this.viewH=this.docH;this.viewW=this.docW;if(window&&window.parent&&window.parent.MapUtil){this.MapUtil=true}if(this.MapUtil){window.parent.MapUtil.ready();if(!this.adminMode){dim=window.parent.MapUtil.getSize();this.resize(dim.width,dim.height)}var b=function(i){if(i.preventDefault){i.preventDefault()}if(i.stopPropagation){i.stopPropagation()}return false},e=function(i){window.parent.MapUtil.contextMenu("close");$(window).unbind("click",e)},g=function(n,j){var k=$(j).attr("class").match(/link\-(\d+)\-(\d+)/),i=$(j).attr("xlink:href");window.parent.MapUtil.contextMenu(i,k[1],k[2],n.pageX,n.pageY);$(window).on("click",e);return b(n)},a=function(j,i){if(j.button!==0){return b(j)}if($(i).attr("xlink:href")){window.parent.location=$(i).attr("xlink:href")}},c=null,h=function(j,i){c=null;if(j.button!==1){return}c=$(i).attr("xlink:href")},d=function(j,i){if(!c||j.button!==1){return}if(c==$(i).attr("xlink:href")){window.open(c)}c=null;return b(j)};window.oncontextmenu=b;$$(".sys").each(function(i){var j=$(i).attr("class").match(/link\-(\d+)\-(\d+)/);$("sys"+j[2]).on("click",function(k){return a(k,i)}).on("contextmenu",function(k){return g(k,i)}).on("mousedown",function(k){return h(k,i)}).on("mouseup",function(k){return d(k,i)})})}this.update()},enableControls:function(){dotSvg.observe(window,"mousedown",function(a){SVGMap.moveStart(a)});dotSvg.observe(window,"mousemove",function(a){SVGMap.moveDo(a)});dotSvg.observe(window,"mouseup",function(a){SVGMap.moveStop(a)});dotSvg.observe(window,"keydown",function(a){SVGMap.keyboard(a)});document.onselectstart=function(){return false};document.ondragstart=function(){return false};dotSvg.observe("zoom_in","click",function(){SVGMap.zoomIn()});dotSvg.observe("zoom_out","click",function(){SVGMap.zoomOut()});dotSvg.observe("wheel_on","click",function(){SVGMap.enableWheel(true)});dotSvg.observe("wheel_off","click",function(){SVGMap.disableWheel(true)});$("controls").attr("style","")},enableWheel:function(a){if(!this.wheel){dotSvg.observe(document,"mousewheel",function(b){SVGMap.mousewheel(b)});dotSvg.observe(document,"DOMMouseScroll",function(b){SVGMap.mousewheel(b)})}$("wheel_on").attr("style","cursor: pointer; display:none;");$("wheel_off").attr("style","cursor: pointer; ");this.wheel=true},disableWheel:function(a){if(this.wheel){dotSvg.stopObserving(document,"mousewheel");dotSvg.stopObserving(document,"DOMMouseScroll")}$("wheel_on").attr("style","cursor: pointer; ");$("wheel_off").attr("style","cursor: pointer; display:none");this.wheel=false},keyboard:function(a){a=a||window.event;if(a.keyCode==40){this.y+=20;this.update()}else{if(a.keyCode==38){this.y-=20;this.update()}else{if(a.keyCode==39){this.x+=20;this.update()}else{if(a.keyCode==37){this.x-=20;this.update()}else{if(a.keyCode==187||a.keyCode==107){this.zoomIn()}else{if(a.keyCode==189||a.keyCode==109){this.zoomOut()}}}}}}},mousewheel:function(a){var b=0;a=a||window.event;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version&&window.opera.version()<10){b=-b}}else{if(a.detail){b=-a.detail/3}}if(b>0){this.zoomIn(a,b)}if(b<0){this.zoomOut(a,b)}if(a.preventDefault){a.preventDefault()}a.returnValue=false},resize:function(a,b){if(this.adminMode){return}this.viewW=(a<0)?0:a;this.viewH=(b<0)?0:b;this.zMin=((this.viewH/this.docH)>(this.viewW/this.docW))?(this.viewW/this.docW)*100:(this.viewH/this.docH)*100;this.zoom=(this.zMin>this.zoom)?this.zMin:this.zoom;this.setLimit();this.update()},setLimit:function(){this.limitXR=((this.docW*(this.zoom/100))-this.viewW<0)?((this.docW*(this.zoom/100))-this.viewW)/2:(this.docW*(this.zoom/100))-this.viewW;this.limitXL=(this.limitXR<0)?this.limitXR:0;this.limitY=((this.docH*(this.zoom/100))-this.viewH<0)?0:(this.docH*(this.zoom/100))-this.viewH},update:function(){if(isNaN(this.x)){this.x=0}else{if(this.x<this.limitXL){this.x=this.limitXL}else{if(this.x>this.limitXR){this.x=this.limitXR}}}if(isNaN(this.y)){this.y=0}else{if(this.y<0){this.y=0}else{if(this.y>this.limitY){this.y=this.limitY}}}this.zoom=isNaN(this.zoom)?this.zMin:(this.zoom<=this.zMin)?this.zMin:(this.zoom>=this.zMax)?this.zMax:this.zoom;this.vb_x=(Math.round((this.x/(this.zoom/100))*100)/100);this.vb_y=(Math.round((this.y/(this.zoom/100))*100)/100);this.vb_w=(Math.round((this.docW/(this.zoom/100))*100)/100);this.vb_h=(Math.round((this.docH/(this.zoom/100))*100)/100);this.transform="translate("+(this.vb_x*(this.zoom/100)*-1)+","+(this.vb_y*(this.zoom/100)*-1)+")";this.scale="scale("+(this.zoom/100)+")";$("map").attr("transform",this.transform+" "+this.scale);if(this.oldZoom!=this.zoom){var a=(Math.round((1/(this.zoom/100))*10)/10)+"";$$(".j").each(function(b){b.attr("style","stroke-width: "+a)});$$(".jc").each(function(b){b.attr("style","stroke-width: "+a)});$$(".jr").each(function(b){b.attr("style","stroke-width: "+a)});this.oldZoom=this.zoom}},debug:function(a){$("debug").firstChild.data=a},green:function(a){if(window&&window.parent&&window.parent.document&&window.parent.document.getElementById("header_sub")){window.parent.document.getElementById("header_sub").innerHTML=a}},moveStart:function(a){if(a.button>0){return}this.drag=true;this.oldX=a.pageX;this.oldY=a.pageY},moveDo:function(a){if(!this.drag){return false}this.x=this.x-parseInt(a.pageX-this.oldX);this.y=this.y-parseInt(a.pageY-this.oldY);this.oldX=a.pageX;this.oldY=a.pageY;this.update()},moveStop:function(a){this.drag=false},setZoom:function(b,a,c){b=(b<=this.zMin)?this.zMin:(b>=this.zMax)?this.zMax:b;if(this.zoom==b&&typeof(a)=="undefined"&&typeof(c)=="undefined"){return}this.zoom=b;this.setLimit();if(typeof(a)!="undefined"&&typeof(c)!="undefined"){this.setPos(a,c)}else{this.update()}},setPos:function(a,b){if(typeof(a)!="undefined"&&typeof(b)!="undefined"){this.x=Math.round((a/this.docW)*this.limitX);this.y=Math.round((b/this.docH)*this.limitY)}this.update()},zoomIn:function(b,e){var a=Math.floor((this.zoom+25)/25)*25;var d=(b&&b.pageX)?b.pageX:this.viewW/2;var c=(b&&b.pageY)?b.pageY:this.viewH/2;a=(a<=this.zMin)?this.zMin:(a>=this.zMax)?this.zMax:a;this.x=Math.round(((this.x+d)/(this.zoom/100))*(a/100))-d;this.y=Math.round(((this.y+c)/(this.zoom/100))*(a/100))-c;this.setZoom(a)},zoomOut:function(b,e){var a=Math.floor((this.zoom-25)/25)*25;var d=(b&&b.pageX)?b.pageX:this.viewW/2;var c=(b&&b.pageY)?b.pageY:this.viewH/2;a=(a<=this.zMin)?this.zMin:(a>=this.zMax)?this.zMax:a;this.x=Math.round(((this.x+d)/(this.zoom/100))*(a/100))-d;this.y=Math.round(((this.y+c)/(this.zoom/100))*(a/100))-c;this.setZoom(a)},clearStandings:function(){$("standings").clear()},getStandingImage:function(a){if(a>5){return"/images/icons/standing_plus_10.png"}else{if(a>0){return"/images/icons/standing_plus_5.png"}else{if(a<-5){return"/images/icons/standing_minus_10.png"}else{if(a<0){return"/images/icons/standing_minus_5.png"}else{return"/images/pixel.gif"}}}}},addStanding:function(g,d){var e=$("sys"+g);if(!e){return}if(!d){$("standings").clear()}var b=parseInt(e.attr("x")),f=parseInt(e.attr("y"));var c=dotSvg.create("a",{id:"standa"+g,"xlink:title":d>0?"+"+d:d,});$(c).insert(dotSvg.create("image",{"xlink:href":this.getStandingImage(d),id:"stand"+g,height:7,width:7,x:b,y:f,"class":"scl"}));$("standings").insert(c)},clearNotes:function(){$("notes").clear()},addNote:function(e){var c=$("sys"+e);if(!c){return}var a=parseInt(c.attr("x")),d=parseInt(c.attr("y"))+18;var b=dotSvg.create("image",{"xlink:href":"/images/icons/note_mini.png",id:"note"+e,height:11,width:10,x:a,y:d,style:"cursor: pointer","class":"note"}).on("mouseover",function(f){if(window.parent&&window.parent.dotNotes){window.parent.dotNotes.over(e,f,true)}}).on("mouseout",function(f){if(window.parent&&window.parent.dotNotes){window.parent.dotNotes.out(e,f)}}).on("click",function(f){if(window.parent&&window.parent.dotNotes){window.parent.dotNotes.click(e,f)}});$("notes").insert(b)},clearCampaigns:function(){$("notes").clear()},addCampaign:function(g,e){var d=$("sys"+g);if(!d){return}var a=parseInt(d.attr("x"))-13.5,f=parseInt(d.attr("y"))-8.5;var b=dotSvg.create("use",{"xlink:href":e?"#defCampaignActive":"#defCampaign",id:"cam"+g,x:a,y:f});$("campaigns").insert(b);var c=$("rect"+g);if(!c){return}c.attr("class",c.attr("class")+" sc")}};
